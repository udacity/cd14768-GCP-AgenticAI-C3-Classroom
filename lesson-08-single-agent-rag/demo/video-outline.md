# cd14768 - Lesson 8 - demo

Implementing Single-Agent RAG with ADK and Vertex AI Search

- Objective: Demonstrate how to build a RAG agent that retrieves information
  from unstructured financial documents indexed in Vertex AI Agent Builder
- Setup
    - Create a Google Cloud Storage bucket and upload the sample PDF files from
      the `docs` folder
    - Go to the "AI Application" configuration in the console (Search for "AI
      Applications")
    - Create a new App of type "Custom Search (general)"
    - Create a Data Store, selecting Cloud Storage as the source and
      "Unstructured documents"
    - Link the Data Store to the App
    - Note the "App ID" (this will be the `DATASTORE_ENGINE_ID`)
    - Note the "Location" (e.g., global)
    - Create or update `.env` with `DATASTORE_PROJECT_ID`, `DATASTORE_LOCATION`,
      and `DATASTORE_ENGINE_ID`
    - Run `gcloud auth application-default login` to authenticate
- [agent.py] Show `root_agent` configuration
    - This is the high-level entry point
    - Point out the `instruction` in `agent-prompt.txt` that guides the agent to
      use the tool for financial questions
    - Highlight `tools=[datastore_search_tool]` as the mechanism for RAG
- [datastore.py] Highlight the `datastore_search_tool` wrapper
    - Show how it simplifies the interface for the agent
    - Takes a single `search_query` string
    - Reads environment variables to pass to the underlying logic
- [datastore.py] Deep dive into the `search` function
    - Explain the `discoveryengine.SearchServiceClient` initialization
    - Show how the `serving_config` path is constructed
    - Discuss the search `request` dictionary:
        - `content_search_spec`: Setting `search_result_mode` to `CHUNKS` is
          critical to get text snippets instead of full PDF downloads
        - `query_expansion_spec`: Enabling `AUTO` expansion helps match synonyms
    - Show how results are extracted from `result.chunk.content`
- Running the code
    - Start `adk web` in the `lesson-08-single-agent-rag` directory
- Demonstration
    - Open the ADK web interface
    - Ask a question relevant to the uploaded documents (e.g., "What are the
      risk factors associated with the company?")
    - Observe the agent "Thinking" and calling `datastore_search_tool`
    - Click on the tool call in the trace to see the input query and the
      returned text chunks
    - Show the final grounded response generated by Gemini
- Conclusion and summary
    - Review how we connected unstructured data in GCS to an agent via Vertex AI
      Agent Builder ("AI Applications")
    - Emphasize the ease of adding RAG capabilities using the ADK tool pattern